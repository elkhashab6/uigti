<html><head><base href="." />
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>النظام المحاسبي المتكامل</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
<style>
  @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap');
  
  body {
    font-family: 'Cairo', sans-serif;
    direction: rtl;
    background: #f5f5f5;
  }
  
  .sidebar {
    background: #2c3e50;
    min-height: 100vh;
    color: white;
    padding: 20px;
  }
  
  .main-content {
    padding: 20px;
  }
  
  .card {
    margin-bottom: 20px;
    transition: transform 0.3s;
  }
  
  .card:hover {
    transform: translateY(-5px);
  }
  
  .nav-link {
    color: white;
    margin: 10px 0;
    padding: 10px;
    border-radius: 5px;
  }
  
  .nav-link:hover {
    background: #34495e;
    color: white;
  }
  
  .stats-card {
    background: linear-gradient(45deg, #3498db, #2980b9);
    color: white;
  }
  
  .chart-container {
    height: 300px;
    margin: 20px 0;
  }

  .page {
    display: none;
  }

  .page.active {
    display: block;
  }

  .data-form {
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }

  .card-header {
    font-weight: bold;
  }

  .account-form {
    margin-bottom: 0;
  }

  .account-form input {
    text-align: left;
    direction: ltr;
  }

  #accounts .card {
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }

  #accounts .card-header {
    padding: 1rem;
  }

  .table input {
    min-width: 100px;
  }

  .table td {
    vertical-align: middle;
  }

  .table input[readonly] {
    background-color: #f8f9fa;
  }
</style>
</head>
<body>
<div class="container-fluid">
  <div class="row">
    <!-- Sidebar -->
    <div class="col-md-3 col-lg-2 sidebar">
      <h3 class="mb-4 text-center">النظام المحاسبي</h3>
      <nav class="nav flex-column">
        <a class="nav-link" href="#" data-page="dashboard"><i class="fas fa-home ml-2"></i> الرئيسية</a>
        <a class="nav-link" href="#" data-page="invoices"><i class="fas fa-file-invoice-dollar"></i> الفواتير</a>
        <a class="nav-link" href="#" data-page="inventory"><i class="fas fa-boxes"></i> المخزون</a>
        <a class="nav-link" href="#" data-page="customers"><i class="fas fa-users"></i> العملاء</a>
        <a class="nav-link" href="#" data-page="suppliers"><i class="fas fa-user-tie"></i> الموردين</a>
        <a class="nav-link" href="#" data-page="reports"><i class="fas fa-chart-bar"></i> التقارير</a>
        <a class="nav-link" href="#" data-page="settings"><i class="fas fa-cog"></i> الإعدادات</a>
        <a class="nav-link" href="#" data-page="accounts"><i class="fas fa-tree"></i> شجرة الحسابات</a>
      </nav>
    </div>

    <!-- Main Content -->
    <div class="col-md-9 col-lg-10 main-content">
      <!-- Dashboard Page -->
      <div id="dashboard" class="page active">
        <div class="row mb-4">
          <div class="col">
            <h2>لوحة التحكم</h2>
            <hr>
          </div>
        </div>

        <!-- Manual Data Entry Form -->
        <div class="row mb-4">
          <div class="col">
            <div class="card">
              <div class="card-body">
                <h5 class="card-title">إدخال البيانات اليدوي</h5>
                <form class="data-form" id="manualDataForm">
                  <div class="row">
                    <div class="col-md-6 mb-3">
                      <label class="form-label">إجمالي المبيعات</label>
                      <input type="number" class="form-control" id="totalSales" placeholder="أدخل إجمالي المبيعات">
                    </div>
                    <div class="col-md-6 mb-3">
                      <label class="form-label">عدد المنتجات في المخزون</label>
                      <input type="number" class="form-control" id="inventoryCount" placeholder="أدخل عدد المنتجات">
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-md-6 mb-3">
                      <label class="form-label">عدد العملاء</label>
                      <input type="number" class="form-control" id="customerCount" placeholder="أدخل عدد العملاء">
                    </div>
                    <div class="col-md-6 mb-3">
                      <label class="form-label">الأرباح</label>
                      <input type="number" class="form-control" id="profits" placeholder="أدخل الأرباح">
                    </div>
                  </div>
                  <button type="submit" class="btn btn-primary">تحديث البيانات</button>
                </form>
              </div>
            </div>
          </div>
        </div>

        <!-- Stats Cards -->
        <div class="row">
          <div class="col-md-3">
            <div class="card stats-card">
              <div class="card-body">
                <h5 class="card-title">إجمالي المبيعات</h5>
                <h3 id="salesDisplay">٠ جنيه</h3>
                <p class="mb-0"><i class="fas fa-arrow-up"></i> <span id="salesGrowth">٠٪</span> هذا الشهر</p>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card stats-card">
              <div class="card-body">
                <h5 class="card-title">المخزون</h5>
                <h3 id="inventoryDisplay">٠ منتج</h3>
                <p class="mb-0"><i class="fas fa-box"></i> <span id="lowStock">٠</span> منتج تحت الحد</p>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card stats-card">
              <div class="card-body">
                <h5 class="card-title">العملاء</h5>
                <h3 id="customersDisplay">٠</h3>
                <p class="mb-0"><i class="fas fa-user-plus"></i> <span id="newCustomers">٠</span> عملاء جدد</p>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card stats-card">
              <div class="card-body">
                <h5 class="card-title">الأرباح</h5>
                <h3 id="profitsDisplay">٠ جنيه</h3>
                <p class="mb-0"><i class="fas fa-arrow-up"></i> <span id="profitGrowth">٠٪</span> نمو</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Charts -->
        <div class="row">
          <div class="col-md-6">
            <div class="card">
              <div class="card-body">
                <h5 class="card-title">المبيعات الشهرية</h5>
                <div class="chart-container">
                  <canvas id="salesChart"></canvas>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="card">
              <div class="card-body">
                <h5 class="card-title">توزيع المنتجات</h5>
                <div class="chart-container">
                  <canvas id="productsChart"></canvas>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Invoices Page -->
      <div id="invoices" class="page">
        <h2>الفواتير</h2>
        <hr>
        
        <!-- Invoice Creation Card -->
        <div class="row mb-4">
          <div class="col-lg-8">
            <div class="card shadow-sm">
              <div class="card-header bg-primary text-white">
                <h5 class="card-title mb-0">
                  <i class="fas fa-file-invoice me-2"></i>
                  إنشاء فاتورة جديدة
                </h5>
              </div>
              <div class="card-body">
                <form id="invoiceForm">
                  <div class="row">
                    <div class="col-md-6 mb-3">
                      <label class="form-label fw-bold">رقم الفاتورة</label>
                      <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-hashtag"></i></span>
                        <input type="text" class="form-control" id="invoiceNumber" readonly>
                      </div>
                    </div>
                    <div class="col-md-6 mb-3">
                      <label class="form-label fw-bold">التاريخ</label>
                      <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-calendar"></i></span>
                        <input type="date" class="form-control" id="invoiceDate">
                      </div>
                    </div>
                  </div>

                  <div class="row">
                    <div class="col-md-6 mb-3">
                      <label class="form-label fw-bold">العميل</label>
                      <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-user"></i></span>
                        <select class="form-select" id="customerSelect">
                          <option value="">اختر العميل</option>
                          <option value="1">شركة الأمل التجارية</option>
                          <option value="2">مؤسسة النور للتجارة</option>
                          <option value="3">شركة الإعمار</option>
                        </select>
                      </div>
                    </div>
                    <div class="col-md-6 mb-3">
                      <label class="form-label fw-bold">طريقة الدفع</label>
                      <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-money-bill"></i></span>
                        <select class="form-select" id="paymentMethod">
                          <option value="cash">نقدي</option>
                          <option value="credit">آجل</option>
                          <option value="bank">تحويل بنكي</option>
                        </select>
                      </div>
                    </div>
                  </div>

                  <div class="table-responsive mb-3">
                    <table class="table table-bordered table-hover" id="invoiceItems">
                      <thead class="table-light">
                        <tr>
                          <th>المنتج</th>
                          <th>الوصف</th>
                          <th>الكمية</th>
                          <th>السعر</th>
                          <th>الإجمالي</th>
                          <th>إجراءات</th>
                        </tr>
                      </thead>
                      <tbody>
                        <!-- Items will be added dynamically -->
                      </tbody>
                      <tfoot>
                        <tr>
                          <td colspan="6">
                            <button type="button" class="btn btn-sm btn-success" onclick="addInvoiceItem()">
                              <i class="fas fa-plus"></i> إضافة منتج يدويًا
                            </button>
                          </td>
                        </tr>
                      </tfoot>
                    </table>
                  </div>

                  <div class="row">
                    <div class="col-md-6">
                      <div class="mb-3">
                        <label class="form-label fw-bold">ملاحظات</label>
                        <textarea class="form-control" rows="3" id="invoiceNotes"></textarea>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="card bg-light">
                        <div class="card-body">
                          <div class="d-flex justify-content-between mb-2">
                            <span>إجمالي المنتجات:</span>
                            <span id="subtotal">0.00 جنيه</span>
                          </div>
                          <div class="d-flex justify-content-between mb-2">
                            <span>الضريبة (14%):</span>
                            <span id="tax">0.00 جنيه</span>
                          </div>
                          <div class="d-flex justify-content-between fw-bold">
                            <span>الإجمالي النهائي:</span>
                            <span id="total">0.00 جنيه</span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="text-end mt-3">
                    <button type="button" class="btn btn-secondary me-2">
                      <i class="fas fa-times"></i> إلغاء
                    </button>
                    <button type="button" class="btn btn-info me-2" onclick="previewAndPrint()">
                      <i class="fas fa-print"></i> معاينة وطباعة
                    </button>
                    <button type="submit" class="btn btn-primary">
                      <i class="fas fa-save"></i> حفظ الفاتورة
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>

          <!-- Recent Invoices Card -->
          <div class="col-lg-4">
            <div class="card shadow-sm">
              <div class="card-header bg-info text-white">
                <h5 class="card-title mb-0">
                  <i class="fas fa-history me-2"></i>
                  آخر الفواتير
                </h5>
              </div>
              <div class="card-body p-0">
                <div class="list-group list-group-flush" id="recentInvoices">
                  <!-- Recent invoices will be added here -->
                </div>
              </div>
            </div>
          </div>
        </div>

        <div id="savedInvoicesSection" class="mt-4"></div>
      </div>

      <!-- Inventory Page -->
      <div id="inventory" class="page">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h2>إدارة المخزون</h2>
          <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addInventoryModal">
            <i class="fas fa-plus"></i> إضافة منتج جديد
          </button>
        </div>
        
        <div class="card mb-4">
          <div class="card-body">
            <div class="row mb-3">
              <div class="col-md-4">
                <div class="input-group">
                  <span class="input-group-text"><i class="fas fa-search"></i></span>
                  <input type="text" class="form-control" id="inventorySearch" placeholder="بحث عن منتج...">
                </div>
              </div>
              <div class="col-md-3">
                <select class="form-select" id="categoryFilter">
                  <option value="">كل الفئات</option>
                  <option value="إلكترونيات">إلكترونيات</option>
                  <option value="أثاث">أثاث</option>
                  <option value="مستلزمات مكتبية">مستلزمات مكتبية</option>
                </select>
              </div>
              <div class="col-md-3">
                <select class="form-select" id="statusFilter">
                  <option value="">كل الحالات</option>
                  <option value="متوفر">متوفر</option>
                  <option value="تحت الحد">تحت الحد</option>
                </select>
              </div>
            </div>

            <div class="table-responsive">
              <table class="table table-hover" id="inventoryTable">
                <thead class="table-light">
                  <tr>
                    <th>كود المنتج</th>
                    <th>اسم المنتج</th>
                    <th>الفئة</th>
                    <th>الكمية</th>
                    <th>السعر</th>
                    <th>حد إعادة الطلب</th>
                    <th>الحالة</th>
                    <th>إجراءات</th>
                  </tr>
                </thead>
                <tbody>
                  <!-- Inventory items will be added dynamically -->
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Statistics Cards -->
        <div class="row">
          <div class="col-md-3">
            <div class="card bg-primary text-white">
              <div class="card-body">
                <h6 class="card-title">إجمالي المنتجات</h6>
                <h3 class="mb-0" id="totalProducts">0</h3>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card bg-warning text-dark">
              <div class="card-body">
                <h6 class="card-title">المنتجات تحت الحد</h6>
                <h3 class="mb-0" id="lowStockProducts">0</h3>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card bg-success text-white">
              <div class="card-body">
                <h6 class="card-title">قيمة المخزون</h6>
                <h3 class="mb-0" id="inventoryValue">0 جنيه</h3>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card bg-info text-white">
              <div class="card-body">
                <h6 class="card-title">متوسط القيمة</h6>
                <h3 class="mb-0" id="averageValue">0 جنيه</h3>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Customers Page -->
      <div id="customers" class="page">
        <h2>العملاء</h2>
        <hr>
        <!-- Add customer management content -->
      </div>

      <!-- Suppliers Page -->
      <div id="suppliers" class="page">
        <h2>الموردين</h2>
        <hr>
        <!-- Add supplier management content -->
      </div>

      <!-- Reports Page -->
      <div id="reports" class="page">
        <div class="row mb-4">
          <div class="col-12">
            <h2>التقارير</h2>
            <hr>
          </div>
        </div>

        <!-- Report Filters -->
        <div class="card mb-4">
          <div class="card-body">
            <div class="row">
              <div class="col-md-3">
                <label class="form-label">نوع التقرير</label>
                <select class="form-select" id="reportType">
                  <option value="sales">تقرير المبيعات</option>
                  <option value="purchases">تقرير المشتريات</option>
                  <option value="inventory">تقرير المخزون</option>
                  <option value="customers">تقرير العملاء</option>
                  <option value="suppliers">تقرير الموردين</option>
                  <option value="profit">تقرير الأرباح والخسائر</option>
                </select>
              </div>
              <div class="col-md-3">
                <label class="form-label">من تاريخ</label>
                <input type="date" class="form-control" id="startDate">
              </div>
              <div class="col-md-3">
                <label class="form-label">إلى تاريخ</label>
                <input type="date" class="form-control" id="endDate">
              </div>
              <div class="col-md-3">
                <label class="form-label">&nbsp;</label>
                <button class="btn btn-primary w-100" onclick="generateReport()">
                  <i class="fas fa-sync"></i> توليد التقرير
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Report Summary Cards -->
        <div class="row mb-4">
          <div class="col-md-3">
            <div class="card bg-primary text-white">
              <div class="card-body">
                <h6 class="card-title">إجمالي المبيعات</h6>
                <h3 id="totalSalesReport">0 جنيه</h3>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card bg-success text-white">
              <div class="card-body">
                <h6 class="card-title">إجمالي المشتريات</h6>
                <h3 id="totalPurchasesReport">0 جنيه</h3>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card bg-info text-white">
              <div class="card-body">
                <h6 class="card-title">صافي الربح</h6>
                <h3 id="netProfitReport">0 جنيه</h3>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card bg-warning text-dark">
              <div class="card-body">
                <h6 class="card-title">عدد المعاملات</h6>
                <h3 id="transactionCountReport">0</h3>
              </div>
            </div>
          </div>
        </div>

        <!-- Report Charts -->
        <div class="row mb-4">
          <div class="col-md-6">
            <div class="card">
              <div class="card-body">
                <h5 class="card-title">تحليل المبيعات</h5>
                <div class="chart-container">
                  <canvas id="salesAnalysisChart"></canvas>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="card">
              <div class="card-body">
                <h5 class="card-title">مقارنة الأداء</h5>
                <div class="chart-container">
                  <canvas id="performanceComparisonChart"></canvas>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Detailed Report Table -->
        <div class="card">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h5 class="card-title mb-0">تفاصيل التقرير</h5>
              <button class="btn btn-success" onclick="exportReport()">
                <i class="fas fa-file-excel"></i> تصدير إلى Excel
              </button>
            </div>
            <div class="table-responsive">
              <table class="table table-striped" id="reportTable">
                <thead>
                  <tr>
                    <th>التاريخ</th>
                    <th>رقم المعاملة</th>
                    <th>النوع</th>
                    <th>العميل/المورد</th>
                    <th>المبلغ</th>
                    <th>الحالة</th>
                  </tr>
                </thead>
                <tbody>
                  <!-- Report data will be inserted here -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Settings Page -->
      <div id="settings" class="page">
        <div class="row">
          <div class="col-md-6 mb-4">
            <div class="card">
              <div class="card-header bg-primary text-white">
                <h5 class="card-title mb-0">إعدادات الشركة</h5>
              </div>
              <div class="card-body">
                <form id="companySettingsForm">
                  <div class="mb-3">
                    <label class="form-label">اسم الشركة</label>
                    <input type="text" class="form-control" id="companyName" placeholder="أدخل اسم الشركة">
                  </div>
                  <div class="mb-3">
                    <label class="form-label">العنوان</label>
                    <textarea class="form-control" id="companyAddress" rows="2" placeholder="أدخل عنوان الشركة"></textarea>
                  </div>
                  <div class="mb-3">
                    <label class="form-label">رقم الهاتف</label>
                    <input type="tel" class="form-control" id="companyPhone" placeholder="أدخل رقم الهاتف">
                  </div>
                  <div class="mb-3">
                    <label class="form-label">البريد الإلكتروني</label>
                    <input type="email" class="form-control" id="companyEmail" placeholder="أدخل البريد الإلكتروني">
                  </div>
                  <div class="mb-3">
                    <label class="form-label">الرقم الضريبي</label>
                    <input type="text" class="form-control" id="taxNumber" placeholder="أدخل الرقم الضريبي">
                  </div>
                  <button type="submit" class="btn btn-primary">حفظ إعدادات الشركة</button>
                </form>
              </div>
            </div>
          </div>

          <div class="col-md-6 mb-4">
            <div class="card">
              <div class="card-header bg-info text-white">
                <h5 class="card-title mb-0">إعدادات النظام</h5>
              </div>
              <div class="card-body">
                <form id="systemSettingsForm">
                  <div class="mb-3">
                    <label class="form-label">العملة الافتراضية</label>
                    <select class="form-select" id="defaultCurrency">
                      <option value="EGP">جنيه مصري</option>
                      <option value="SAR">ريال سعودي</option>
                      <option value="USD">دولار أمريكي</option>
                    </select>
                  </div>
                  <div class="mb-3">
                    <label class="form-label">نسبة الضريبة الافتراضية</label>
                    <div class="input-group">
                      <input type="number" class="form-control" id="defaultTaxRate" value="14">
                      <span class="input-group-text">%</span>
                    </div>
                  </div>
                  <div class="mb-3">
                    <label class="form-label">اللغة الافتراضية</label>
                    <select class="form-select" id="defaultLanguage">
                      <option value="ar">العربية</option>
                      <option value="en">English</option>
                    </select>
                  </div>
                  <div class="mb-3">
                    <label class="form-label">عدد العناصر في الصفحة</label>
                    <input type="number" class="form-control" id="itemsPerPage" value="10">
                  </div>
                  <div class="form-check mb-3">
                    <input type="checkbox" class="form-check-input" id="enableNotifications">
                    <label class="form-check-label">تفعيل الإشعارات</label>
                  </div>
                  <button type="submit" class="btn btn-info">حفظ إعدادات النظام</button>
                </form>
              </div>
            </div>
          </div>

          <div class="col-md-6 mb-4">
            <div class="card">
              <div class="card-header bg-success text-white">
                <h5 class="card-title mb-0">إعدادات الفواتير</h5>
              </div>
              <div class="card-body">
                <form id="invoiceSettingsForm">
                  <div class="mb-3">
                    <label class="form-label">بادئة رقم الفاتورة</label>
                    <input type="text" class="form-control" id="invoicePrefix" placeholder="مثال: INV-">
                  </div>
                  <div class="mb-3">
                    <label class="form-label">تذييل الفاتورة</label>
                    <textarea class="form-control" id="invoiceFooter" rows="2" placeholder="نص تذييل الفاتورة"></textarea>
                  </div>
                  <div class="form-check mb-3">
                    <input type="checkbox" class="form-check-input" id="showLogo">
                    <label class="form-check-label">إظهار شعار الشركة</label>
                  </div>
                  <div class="form-check mb-3">
                    <input type="checkbox" class="form-check-input" id="showQRCode">
                    <label class="form-check-label">إظهار رمز QR</label>
                  </div>
                  <button type="submit" class="btn btn-success">حفظ إعدادات الفواتير</button>
                </form>
              </div>
            </div>
          </div>

          <div class="col-md-6 mb-4">
            <div class="card">
              <div class="card-header bg-warning text-dark">
                <h5 class="card-title mb-0">النسخ الاحتياطي</h5>
              </div>
              <div class="card-body">
                <div class="mb-4">
                  <h6>آخر نسخة احتياطية</h6>
                  <p id="lastBackupDate">لم يتم عمل نسخة احتياطية بعد</p>
                </div>
                <button type="button" class="btn btn-warning me-2" onclick="createBackup()">
                  <i class="fas fa-download"></i> إنشاء نسخة احتياطية
                </button>
                <button type="button" class="btn btn-outline-warning" onclick="restoreBackup()">
                  <i class="fas fa-upload"></i> استعادة نسخة احتياطية
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Accounts Page -->
      <div id="accounts" class="page">
        <h2>شجرة الحسابات</h2>
        <hr>
        
        <!-- Account Tree Cards -->
        <div class="row">
          <!-- Assets Card -->
          <div class="col-md-6 mb-4">
            <div class="card">
              <div class="card-header bg-primary text-white">
                <h5 class="card-title mb-0">الأصول</h5>
              </div>
              <div class="card-body">
                <form class="account-form">
                  <div class="mb-3">
                    <label class="form-label">الأصول المتداولة</label>
                    <div class="ms-4">
                      <div class="mb-2">
                        <label class="form-label">نقدية</label>
                        <input type="number" class="form-control" name="cash" placeholder="القيمة">
                      </div>
                      <div class="mb-2">
                        <label class="form-label">عملاء</label>
                        <input type="number" class="form-control" name="customers_receivable" placeholder="القيمة">
                      </div>
                      <div class="mb-2">
                        <label class="form-label">استثمارات قصيرة الأجل</label>
                        <input type="number" class="form-control" name="short_term_investments" placeholder="القيمة">
                      </div>
                      <div class="mb-2">
                        <label class="form-label">مخزون</label>
                        <input type="number" class="form-control" name="inventory" placeholder="القيمة">
                      </div>
                    </div>
                  </div>
                  <div class="mb-3">
                    <label class="form-label">الأصول غير المتداولة</label>
                    <div class="ms-4">
                      <div class="mb-2">
                        <label class="form-label">استثمارات طويلة الأجل</label>
                        <input type="number" class="form-control" name="long_term_investments" placeholder="القيمة">
                      </div>
                      <div class="mb-2">
                        <label class="form-label">أصول غير ملموسة</label>
                        <input type="number" class="form-control" name="intangible_assets" placeholder="القيمة">
                      </div>
                    </div>
                  </div>
                </form>
              </div>
            </div>
          </div>

          <!-- Liabilities Card -->
          <div class="col-md-6 mb-4">
            <div class="card">
              <div class="card-header bg-warning text-dark">
                <h5 class="card-title mb-0">الخصوم والالتزامات</h5>
              </div>
              <div class="card-body">
                <form class="account-form">
                  <div class="mb-3">
                    <label class="form-label">خصوم طويلة الأجل</label>
                    <div class="ms-4">
                      <div class="mb-2">
                        <label class="form-label">قروض طويلة الأجل</label>
                        <input type="number" class="form-control" name="long_term_loans" placeholder="القيمة">
                      </div>
                      <div class="mb-2">
                        <label class="form-label">التزامات ضريبية مؤجلة</label>
                        <input type="number" class="form-control" name="deferred_tax" placeholder="القيمة">
                      </div>
                      <div class="mb-2">
                        <label class="form-label">التزامات التقاعد</label>
                        <input type="number" class="form-control" name="retirement_obligations" placeholder="القيمة">
                      </div>
                    </div>
                  </div>
                  <div class="mb-3">
                    <label class="form-label">التزامات متداولة قصيرة الأجل</label>
                    <div class="ms-4">
                      <div class="mb-2">
                        <label class="form-label">قروض قصيرة الأجل</label>
                        <input type="number" class="form-control" name="short_term_loans" placeholder="القيمة">
                      </div>
                      <div class="mb-2">
                        <label class="form-label">رواتب وأجور الموظفين</label>
                        <input type="number" class="form-control" name="salaries_payable" placeholder="القيمة">
                      </div>
                      <div class="mb-2">
                        <label class="form-label">الموردين والدائنين</label>
                        <input type="number" class="form-control" name="accounts_payable" placeholder="القيمة">
                      </div>
                    </div>
                  </div>
                </form>
              </div>
            </div>
          </div>

          <!-- Equity Card -->
          <div class="col-md-6 mb-4">
            <div class="card">
              <div class="card-header bg-success text-white">
                <h5 class="card-title mb-0">حقوق الملكية</h5>
              </div>
              <div class="card-body">
                <form class="account-form">
                  <div class="mb-3">
                    <label class="form-label">رأس المال والتغيرات</label>
                    <input type="number" class="form-control" name="capital_changes" placeholder="القيمة">
                  </div>
                  <div class="mb-3">
                    <label class="form-label">الاحتياطات النقدية</label>
                    <input type="number" class="form-control" name="cash_reserves" placeholder="القيمة">
                  </div>
                  <div class="mb-3">
                    <label class="form-label">الأرباح المحتجزة</label>
                    <input type="number" class="form-control" name="retained_earnings" placeholder="القيمة">
                  </div>
                </form>
              </div>
            </div>
          </div>

          <!-- Revenue Card -->
          <div class="col-md-6 mb-4">
            <div class="card">
              <div class="card-header bg-info text-white">
                <h5 class="card-title mb-0">الإيرادات</h5>
              </div>
              <div class="card-body">
                <form class="account-form">
                  <div class="mb-3">
                    <label class="form-label">إيرادات المبيعات</label>
                    <input type="number" class="form-control" name="sales_revenue" placeholder="القيمة">
                  </div>
                  <div class="mb-3">
                    <label class="form-label">إيرادات متنوعة</label>
                    <input type="number" class="form-control" name="other_revenue" placeholder="القيمة">
                  </div>
                </form>
              </div>
            </div>
          </div>

          <!-- Expenses Card -->
          <div class="col-md-6 mb-4">
            <div class="card">
              <div class="card-header bg-danger text-white">
                <h5 class="card-title mb-0">المصروفات</h5>
              </div>
              <div class="card-body">
                <form class="account-form">
                  <div class="mb-3">
                    <label class="form-label">مصروفات إدارية</label>
                    <input type="number" class="form-control" name="admin_expenses" placeholder="القيمة">
                  </div>
                  <div class="mb-3">
                    <label class="form-label">مصروفات تشغيلية</label>
                    <input type="number" class="form-control" name="operating_expenses" placeholder="القيمة">
                  </div>
                  <div class="mb-3">
                    <label class="form-label">مصروفات بيعية</label>
                    <input type="number" class="form-control" name="selling_expenses" placeholder="القيمة">
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>

        <!-- Summary Button -->
        <div class="row">
          <div class="col-12">
            <button class="btn btn-primary" onclick="calculateAccountingSummary()">
              حساب الميزانية
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Add/Edit Inventory Item Modal -->
<div class="modal fade" id="addInventoryModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">إضافة منتج جديد</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="inventoryForm">
          <div class="mb-3">
            <label class="form-label">كود المنتج</label>
            <input type="text" class="form-control" id="productCode" required>
          </div>
          <div class="mb-3">
            <label class="form-label">اسم المنتج</label>
            <input type="text" class="form-control" id="productName" required>
          </div>
          <div class="mb-3">
            <label class="form-label">الفئة</label>
            <select class="form-select" id="productCategory" required>
              <option value="">اختر الفئة</option>
              <option value="إلكترونيات">إلكترونيات</option>
              <option value="أثاث">أثاث</option>
              <option value="مستلزمات مكتبية">مستلزمات مكتبية</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">الكمية</label>
            <input type="number" class="form-control" id="productQuantity" required min="0">
          </div>
          <div class="mb-3">
            <label class="form-label">السعر</label>
            <input type="number" class="form-control" id="productPrice" required min="0">
          </div>
          <div class="mb-3">
            <label class="form-label">حد إعادة الطلب</label>
            <input type="number" class="form-control" id="reorderPoint" required min="0">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
        <button type="button" class="btn btn-primary" onclick="saveInventoryItem()">حفظ</button>
      </div>
    </div>
  </div>
</div>

<!-- Add Customer Modal -->
<div class="modal fade" id="addCustomerModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">إضافة عميل جديد</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="customerForm">
          <div class="mb-3">
            <label class="form-label">اسم العميل</label>
            <input type="text" class="form-control" id="customerName" required>
          </div>
          <div class="mb-3">
            <label class="form-label">رقم الهاتف</label>
            <input type="tel" class="form-control" id="customerPhone" required>
          </div>
          <div class="mb-3">
            <label class="form-label">البريد الإلكتروني</label>
            <input type="email" class="form-control" id="customerEmail">
          </div>
          <div class="mb-3">
            <label class="form-label">العنوان</label>
            <textarea class="form-control" id="customerAddress" rows="2"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
        <button type="button" class="btn btn-primary" onclick="saveCustomer()">حفظ</button>
      </div>
    </div>
  </div>
</div>

<!-- Add Supplier Modal -->
<div class="modal fade" id="addSupplierModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">إضافة مورد جديد</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="supplierForm">
          <div class="mb-3">
            <label class="form-label">اسم المورد</label>
            <input type="text" class="form-control" id="supplierName" required>
          </div>
          <div class="mb-3">
            <label class="form-label">جهة الاتصال</label>
            <input type="text" class="form-control" id="supplierContact" required>
          </div>
          <div class="mb-3">
            <label class="form-label">رقم الهاتف</label>
            <input type="tel" class="form-control" id="supplierPhone" required>
          </div>
          <div class="mb-3">
            <label class="form-label">البريد الإلكتروني</label>
            <input type="email" class="form-control" id="supplierEmail">
          </div>
          <div class="mb-3">
            <label class="form-label">العنوان</label>
            <textarea class="form-control" id="supplierAddress" rows="2"></textarea>
          </div>
          <div class="mb-3">
            <label class="form-label">الفئة</label>
            <select class="form-select" id="supplierCategory" required>
              <option value="">اختر الفئة</option>
              <option value="إلكترونيات">إلكترونيات</option>
              <option value="أثاث">أثاث</option>
              <option value="مستلزمات مكتبية">مستلزمات مكتبية</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">شروط الدفع</label>
            <select class="form-select" id="paymentTerms">
              <option value="صافي 30 يوم">صافي 30 يوم</option>
              <option value="صافي 60 يوم">صافي 60 يوم</option>
              <option value="نقدي">نقدي</option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
        <button type="button" class="btn btn-primary" onclick="saveSupplier()">حفظ</button>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
let savedInvoices = []; // Array to store saved invoices

// Sample suppliers data
const sampleSuppliers = [
  {
    id: 1,
    name: 'شركة التوريدات العامة',
    contact: 'أحمد محمد',
    phone: '0123456789',
    email: 'ahmed@supplies.com',
    address: 'شارع النصر، القاهرة',
    balance: 25000,
    lastOrder: '2024-01-15',
    paymentTerms: 'صافي 30 يوم',
    category: 'إلكترونيات'
  },
  {
    id: 2,
    name: 'مؤسسة المستقبل للتجارة',
    contact: 'محمد علي',
    phone: '0198765432', 
    email: 'mohamed@future.com',
    address: 'شارع الملك عبدالله، الرياض',
    balance: 35000,
    lastOrder: '2024-01-14',
    paymentTerms: 'صافي 60 يوم',
    category: 'أثاث'
  }
];

document.addEventListener('DOMContentLoaded', function() {
    // Initialize suppliers on load
    initializeSuppliers();
    
    // Form submission handling
    document.getElementById('manualDataForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Get form values
        const sales = document.getElementById('totalSales').value;
        const inventory = document.getElementById('inventoryCount').value;
        const customers = document.getElementById('customerCount').value;
        const profits = document.getElementById('profits').value;

        // Update displays
        document.getElementById('salesDisplay').textContent = sales + ' جنيه';
        document.getElementById('inventoryDisplay').textContent = inventory + ' منتج';
        document.getElementById('customersDisplay').textContent = customers;
        document.getElementById('profitsDisplay').textContent = profits + ' جنيه';

        // Random growth calculations (for demonstration)
        document.getElementById('salesGrowth').textContent = Math.floor(Math.random() * 30) + '٪';
        document.getElementById('lowStock').textContent = Math.floor(inventory * 0.1);
        document.getElementById('newCustomers').textContent = Math.floor(customers * 0.05);
        document.getElementById('profitGrowth').textContent = Math.floor(Math.random() * 25) + '٪';

        // Update charts
        updateCharts(sales);
    });

    // Navigation
    document.querySelectorAll('.nav-link').forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const pageId = this.getAttribute('data-page');
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
            
            document.querySelectorAll('.nav-link').forEach(navLink => {
                navLink.classList.remove('active');
            });
            this.classList.add('active');
        });
    });

    // Initialize charts
    let salesChart = null;
    let productsChart = null;

    function initializeCharts() {
        const salesCtx = document.getElementById('salesChart').getContext('2d');
        salesChart = new Chart(salesCtx, {
            type: 'line',
            data: {
                labels: ['يناير', 'فبراير', 'مارس', 'ابريل', 'مايو', 'يونيو'],
                datasets: [{
                    label: 'المبيعات الشهرية',
                    data: [0, 0, 0, 0, 0, 0],
                    fill: false,
                    borderColor: '#3498db',
                    tension: 0.1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false
            }
        });

        const productsCtx = document.getElementById('productsChart').getContext('2d');
        productsChart = new Chart(productsCtx, {
            type: 'doughnut',
            data: {
                labels: ['إلكترونيات', 'ملابس', 'أثاث', 'طعام', 'أخرى'],
                datasets: [{
                    data: [0, 0, 0, 0, 0],
                    backgroundColor: [
                        '#3498db',
                        '#e74c3c',
                        '#2ecc71',
                        '#f1c40f',
                        '#95a5a6'
                    ]
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false
            }
        });
    }

    function updateCharts(sales) {
        // Update sales chart with random data based on input
        const newSalesData = Array(6).fill(0).map(() => 
            Math.floor(sales * (0.5 + Math.random()))
        );
        salesChart.data.datasets[0].data = newSalesData;
        salesChart.update();

        // Update products chart with random distribution
        const total = 100;
        const newProductData = [
            Math.floor(Math.random() * 30),
            Math.floor(Math.random() * 25),
            Math.floor(Math.random() * 20),
            Math.floor(Math.random() * 15),
            Math.floor(Math.random() * 10)
        ];
        productsChart.data.datasets[0].data = newProductData;
        productsChart.update();
    }

    // Initialize charts on load
    initializeCharts();
});

// Initialize invoice number
let currentInvoiceNumber = 1000;

// Set default date
document.addEventListener('DOMContentLoaded', function() {
  const today = new Date().toISOString().split('T')[0];
  document.getElementById('invoiceDate').value = today;
  document.getElementById('invoiceNumber').value = 'INV-' + currentInvoiceNumber;
  
  // Add sample recent invoices
  addSampleRecentInvoices();
});

function addInvoiceItem() {
  const tbody = document.querySelector('#invoiceItems tbody');
  const row = document.createElement('tr');
  row.innerHTML = `
    <td>
      <input type="text" class="form-control" placeholder="اسم المنتج">
    </td>
    <td>
      <input type="text" class="form-control" placeholder="وصف المنتج">
    </td>
    <td>
      <input type="number" class="form-control quantity-input" value="1" min="1">
    </td>
    <td>
      <input type="number" class="form-control price-input" placeholder="سعر الوحدة">
    </td>
    <td>
      <input type="number" class="form-control" readonly>
    </td>
    <td>
      <button type="button" class="btn btn-danger btn-sm" onclick="removeItem(this)">
        <i class="fas fa-trash"></i>
      </button>
    </td>
  `;
  tbody.appendChild(row);
  
  // Initialize automatic calculation for the new row
  updateTotal(row.querySelector('.quantity-input'));
}

function updateTotal(input) {
  const row = input.closest('tr');
  const qtyInput = row.querySelector('td:nth-child(3) input');
  const priceInput = row.querySelector('td:nth-child(4) input');
  const totalInput = row.querySelector('td:nth-child(5) input');
  
  // Add event listeners to quantity and price inputs if not already added
  if (!qtyInput.hasEventListener) {
    qtyInput.addEventListener('input', function() {
      calculate();
    });
    qtyInput.hasEventListener = true;
  }
  
  if (!priceInput.hasEventListener) {
    priceInput.addEventListener('input', function() {
      calculate(); 
    });
    priceInput.hasEventListener = true;
  }
  
  function calculate() {
    const price = parseFloat(priceInput.value) || 0;
    const qty = parseFloat(qtyInput.value) || 0;
    const total = price * qty;
    totalInput.value = total.toFixed(2);
    calculateInvoiceTotal();
  }
  
  calculate();
}

// Handle form submission
document.getElementById('invoiceForm').addEventListener('submit', function(e) {
  e.preventDefault();

  // Gather invoice details
  const invoiceDetails = {
    invoiceNumber: document.getElementById('invoiceNumber').value,
    date: document.getElementById('invoiceDate').value,
    customer: document.getElementById('customerSelect').options[document.getElementById('customerSelect').selectedIndex].text,
    paymentMethod: document.getElementById('paymentMethod').options[document.getElementById('paymentMethod').selectedIndex].text,
    items: [],
    subtotal: document.getElementById('subtotal').textContent,
    tax: document.getElementById('tax').textContent,  
    total: document.getElementById('total').textContent,
    notes: document.getElementById('invoiceNotes').value
  };

  // Gather items
  document.querySelectorAll('#invoiceItems tbody tr').forEach(row => {
    const item = {
      product: row.querySelector('td:nth-child(1) input').value,
      description: row.querySelector('td:nth-child(2) input').value,
      quantity: row.querySelector('td:nth-child(3) input').value,
      price: row.querySelector('td:nth-child(4) input').value,
      total: row.querySelector('td:nth-child(5) input').value
    };
    invoiceDetails.items.push(item);
  });

  // Save invoice
  savedInvoices.push(invoiceDetails);
  
  // Update saved invoices table
  displaySavedInvoices();

  // Show success message and print option
  if(confirm('تم حفظ الفاتورة بنجاح! هل تريد طباعة الفاتورة؟')) {
    printInvoice(savedInvoices.length - 1);
  }
  
  // Clear form
  document.getElementById('invoiceForm').reset();
  currentInvoiceNumber++;
  document.getElementById('invoiceNumber').value = 'INV-' + currentInvoiceNumber;
});

function displaySavedInvoices() {
  // Create or update saved invoices section if it doesn't exist
  let savedInvoicesSection = document.querySelector('#savedInvoicesSection');
  if (!savedInvoicesSection) {
    savedInvoicesSection = document.createElement('div');
    savedInvoicesSection.id = 'savedInvoicesSection';
    savedInvoicesSection.className = 'mt-4';
    document.querySelector('#invoices').appendChild(savedInvoicesSection);
  }

  savedInvoicesSection.innerHTML = `
    <div class="card shadow-sm">
      <div class="card-header bg-success text-white">
        <h5 class="card-title mb-0">
          <i class="fas fa-file-invoice me-2"></i>
          الفواتير المحفوظة
        </h5>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-striped table-hover">
            <thead>
              <tr>
                <th>رقم الفاتورة</th>
                <th>التاريخ</th>
                <th>العميل</th>
                <th>طريقة الدفع</th>
                <th>عدد الأصناف</th>
                <th>الإجمالي</th>
                <th>إجراءات</th>
              </tr>
            </thead>
            <tbody>
              ${savedInvoices.map((invoice, index) => `
                <tr>
                  <td>${invoice.invoiceNumber}</td>
                  <td>${invoice.date}</td>
                  <td>${invoice.customer}</td>
                  <td>${invoice.paymentMethod}</td>
                  <td>${invoice.items.length}</td>
                  <td>${invoice.total}</td>
                  <td>
                    <button class="btn btn-sm btn-info" onclick="viewInvoiceDetails(${index})">
                      <i class="fas fa-eye"></i>
                    </button>
                    <button class="btn btn-sm btn-danger" onclick="deleteInvoice(${index})">
                      <i class="fas fa-trash"></i>
                    </button>
                  </td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  `;
}

function viewInvoiceDetails(index) {
  const invoice = savedInvoices[index];
  
  const modal = document.createElement('div');
  modal.className = 'modal fade';
  modal.innerHTML = `
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header bg-info text-white">
          <h5 class="modal-title">تفاصيل الفاتورة ${invoice.invoiceNumber}</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="row mb-3">
            <div class="col-md-6">
              <strong>التاريخ:</strong> ${invoice.date}
            </div>
            <div class="col-md-6">
              <strong>العميل:</strong> ${invoice.customer}
            </div>
          </div>
          <div class="table-responsive">
            <table class="table table-bordered">
              <thead>
                <tr>
                  <th>المنتج</th>
                  <th>الوصف</th>
                  <th>الكمية</th>
                  <th>السعر</th>
                  <th>الإجمالي</th>
                </tr>
              </thead>
              <tbody>
                ${invoice.items.map(item => `
                  <tr>
                    <td>${item.product}</td>
                    <td>${item.description}</td>
                    <td>${item.quantity}</td>
                    <td>${item.price}</td>
                    <td>${item.total}</td>
                  </tr>
                `).join('')}
              </tbody>
              <tfoot>
                <tr>
                  <td colspan="4" class="text-end"><strong>المجموع:</strong></td>
                  <td>${invoice.subtotal}</td>
                </tr>
                <tr>
                  <td colspan="4" class="text-end"><strong>الضريبة:</strong></td>
                  <td>${invoice.tax}</td>
                </tr>
                <tr>
                  <td colspan="4" class="text-end"><strong>الإجمالي النهائي:</strong></td>
                  <td>${invoice.total}</td>
                </tr>
              </tfoot>
            </table>
          </div>
          ${invoice.notes ? `
            <div class="mt-3">
              <strong>ملاحظات:</strong>
              <p>${invoice.notes}</p>
            </div>
          ` : ''}
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إغلاق</button>
          <button type="button" class="btn btn-primary" onclick="printInvoice(${index})">
            <i class="fas fa-print"></i> طباعة
          </button>
        </div>
      </div>
    </div>
  `;

  document.body.appendChild(modal);
  const modalInstance = new bootstrap.Modal(modal);
  modalInstance.show();
  
  modal.addEventListener('hidden.bs.modal', () => {
    document.body.removeChild(modal);
  });
}

function deleteInvoice(index) {
  if (confirm('هل أنت متأكد من حذف هذه الفاتورة؟')) {
    savedInvoices.splice(index, 1);
    displaySavedInvoices();
  }
}

function printInvoice(index) {
  const invoice = savedInvoices[index];
  const printWindow = window.open('', '', 'width=800,height=600');
  printWindow.document.write(`
    <html dir="rtl">
      <head>
        <title>طباعة الفاتورة - ${invoice.invoiceNumber}</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
        <style>
          @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap');
          body { font-family: 'Cairo', sans-serif; }
          @media print {
            .no-print { display: none; }
          }
          .invoice-header { border-bottom: 2px solid #dee2e6; padding-bottom: 20px; margin-bottom: 20px; }
          .company-info { margin-bottom: 20px; }
        </style>
      </head>
      <body class="p-4">
        <div class="container">
          <div class="invoice-header">
            <div class="row">
              <div class="col text-start">
                <h1>فاتورة</h1>
                <h5>رقم: ${invoice.invoiceNumber}</h5>
                <h5>التاريخ: ${invoice.date}</h5>
              </div>
              <div class="col text-end">
                <div class="company-info">
                  <h3>اسم الشركة</h3>
                  <p>العنوان: شارع الرئيسي، المدينة</p>
                  <p>الهاتف: 123456789</p>
                </div>
              </div>
            </div>
          </div>

          <div class="row mb-4">
            <div class="col-6">
              <h5>معلومات العميل:</h5>
              <p>العميل: ${invoice.customer}</p>
              <p>طريقة الدفع: ${invoice.paymentMethod}</p>
            </div>
          </div>

          <div class="table-responsive mb-4">
            <table class="table table-bordered">
              <thead class="table-light">
                <tr>
                  <th>#</th>
                  <th>المنتج</th>
                  <th>الوصف</th>
                  <th>الكمية</th>
                  <th>السعر</th>
                  <th>الإجمالي</th>
                </tr>
              </thead>
              <tbody>
                ${invoice.items.map((item, idx) => `
                  <tr>
                    <td>${idx + 1}</td>
                    <td>${item.product}</td>
                    <td>${item.description}</td>
                    <td>${item.quantity}</td>
                    <td>${item.price}</td>
                    <td>${item.total}</td>
                  </tr>
                `).join('')}
              </tbody>
              <tfoot>
                <tr>
                  <td colspan="5" class="text-end"><strong>المجموع:</strong></td>
                  <td>${invoice.subtotal}</td>
                </tr>
                <tr>
                  <td colspan="5" class="text-end"><strong>الضريبة:</strong></td>
                  <td>${invoice.tax}</td>
                </tr>
                <tr>
                  <td colspan="5" class="text-end"><strong>الإجمالي النهائي:</strong></td>
                  <td>${invoice.total}</td>
                </tr>
              </tfoot>
            </table>
          </div>

          ${invoice.notes ? `
            <div class="mb-4">
              <h5>ملاحظات:</h5>
              <p>${invoice.notes}</p>
            </div>
          ` : ''}

          <div class="row mt-4">
            <div class="col-12 text-center">
              <p class="mb-0">شكراً لتعاملكم معنا</p>
            </div>
          </div>
        </div>
        <div class="text-center mt-4">
          <button class="btn btn-primary no-print" onclick="window.print()">طباعة</button>
        </div>
      </body>
    </html>
  `);
  printWindow.document.close();
}

function calculateInvoiceTotal() {
  const totals = Array.from(document.querySelectorAll('#invoiceItems tbody tr td:nth-child(5) input'))
    .map(input => Number(input.value));
  
  const subtotal = totals.reduce((sum, total) => sum + total, 0);
  const tax = subtotal * 0.14;
  const total = subtotal + tax;
  
  document.getElementById('subtotal').textContent = subtotal.toFixed(2) + ' جنيه';
  document.getElementById('tax').textContent = tax.toFixed(2) + ' جنيه';
  document.getElementById('total').textContent = total.toFixed(2) + ' جنيه';
}

function addSampleRecentInvoices() {
  const recentInvoices = document.getElementById('recentInvoices');
  const sampleInvoices = [
    { number: 'INV-999', customer: 'شركة الأمل التجارية', date: '2024-01-15', amount: '1,500.00' },
    { number: 'INV-998', customer: 'مؤسسة النور للتجارة', date: '2024-01-14', amount: '2,300.00' },
    { number: 'INV-997', customer: 'شركة الإعمار', date: '2024-01-13', amount: '3,750.00' }
  ];
  
  sampleInvoices.forEach(invoice => {
    const item = document.createElement('a');
    item.href = '#';
    item.className = 'list-group-item list-group-item-action';
    item.innerHTML = `
      <div class="d-flex w-100 justify-content-between">
        <h6 class="mb-1">${invoice.number}</h6>
        <small>${invoice.amount} جنيه</small>
      </div>
      <p class="mb-1">${invoice.customer}</p>
      <small class="text-muted">${invoice.date}</small>
    `;
    recentInvoices.appendChild(item);
  });
}

// Inventory Management Functions
function setupInventoryFilters() {
  const categoryFilter = document.getElementById('categoryFilter');
  const statusFilter = document.getElementById('statusFilter');

  categoryFilter.addEventListener('change', filterInventory);
  statusFilter.addEventListener('change', filterInventory);
}

function setupInventorySearch() {
  const searchInput = document.getElementById('inventorySearch');
  searchInput.addEventListener('input', filterInventory);
}

function filterInventory() {
  const searchTerm = document.getElementById('inventorySearch').value.toLowerCase();
  const categoryFilter = document.getElementById('categoryFilter').value;
  const statusFilter = document.getElementById('statusFilter').value;
  
  const tbody = document.querySelector('#inventoryTable tbody');
  tbody.innerHTML = sampleInventoryData
    .filter(item => {
      const matchesSearch = 
        item.name.toLowerCase().includes(searchTerm) ||
        item.code.toLowerCase().includes(searchTerm);
        
      const matchesCategory = 
        !categoryFilter || item.category === categoryFilter;
        
      const status = item.quantity <= item.reorderPoint ? 'تحت الحد' : 'متوفر';
      const matchesStatus = 
        !statusFilter || status === statusFilter;
        
      return matchesSearch && matchesCategory && matchesStatus;
    })
    .map(item => `
      <tr>
        <td>${item.code}</td>
        <td>${item.name}</td>
        <td>${item.category}</td>
        <td>${item.quantity}</td>
        <td>${item.price} جنيه</td>
        <td>${item.reorderPoint}</td>
        <td>
          <span class="badge ${item.quantity <= item.reorderPoint ? 'bg-danger' : 'bg-success'}">
            ${item.quantity <= item.reorderPoint ? 'تحت الحد' : 'متوفر'}
          </span>
        </td>
        <td>
          <button class="btn btn-sm btn-primary me-1" onclick="editInventoryItem(${item.id})">
            <i class="fas fa-edit"></i>
          </button>
          <button class="btn btn-sm btn-danger" onclick="deleteInventoryItem(${item.id})">
            <i class="fas fa-trash"></i>
          </button>
        </td>
      </tr>
    `).join('');
}

function initializeInventory() {
  updateInventoryTable();
  setupInventoryFilters();
  setupInventorySearch();
}

function updateInventoryTable() {
  const tbody = document.querySelector('#inventoryTable tbody');
  tbody.innerHTML = sampleInventoryData.map(item => `
    <tr>
      <td>${item.code}</td>
      <td>${item.name}</td>
      <td>${item.category}</td>
      <td>${item.quantity}</td>
      <td>${item.price} جنيه</td>
      <td>${item.reorderPoint}</td>
      <td>
        <span class="badge ${item.quantity <= item.reorderPoint ? 'bg-danger' : 'bg-success'}">
          ${item.quantity <= item.reorderPoint ? 'تحت الحد' : 'متوفر'}
        </span>
      </td>
      <td>
        <button class="btn btn-sm btn-primary me-1" onclick="editInventoryItem(${item.id})">
          <i class="fas fa-edit"></i>
        </button>
        <button class="btn btn-sm btn-danger" onclick="deleteInventoryItem(${item.id})">
          <i class="fas fa-trash"></i>
        </button>
      </td>
    </tr>
  `).join('');
}

const sampleInventoryData = [
  { id: 1, code: 'P001', name: 'لابتوب HP', category: 'إلكترونيات', quantity: 15, price: 12000, reorderPoint: 5 },
  { id: 2, code: 'P002', name: 'طابعة Canon', category: 'إلكترونيات', quantity: 8, price: 3500, reorderPoint: 3 },
  { id: 3, code: 'P003', name: 'مكتب خشبي', category: 'أثاث', quantity: 4, price: 2500, reorderPoint: 2 },
  // Add more sample items as needed
];

function editInventoryItem(id) {
  const item = sampleInventoryData.find(i => i.id === id);
  if (item) {
    document.getElementById('productCode').value = item.code;
    document.getElementById('productName').value = item.name;
    document.getElementById('productCategory').value = item.category;
    document.getElementById('productQuantity').value = item.quantity;
    document.getElementById('productPrice').value = item.price;
    document.getElementById('reorderPoint').value = item.reorderPoint;
    
    const modal = new bootstrap.Modal(document.getElementById('addInventoryModal'));
    modal.show();
  }
}

function deleteInventoryItem(id) {
  if (confirm('هل أنت متأكد من حذف هذا المنتج؟')) {
    const index = sampleInventoryData.findIndex(i => i.id === id);
    if (index !== -1) {
      sampleInventoryData.splice(index, 1);
      updateInventoryTable();
      updateInventoryStats();
    }
  }
}

function saveInventoryItem() {
  const form = document.getElementById('inventoryForm');
  if (form.checkValidity()) {
    const newItem = {
      id: sampleInventoryData.length + 1,
      code: document.getElementById('productCode').value,
      name: document.getElementById('productName').value,
      category: document.getElementById('productCategory').value,
      quantity: parseInt(document.getElementById('productQuantity').value),
      price: parseFloat(document.getElementById('productPrice').value),
      reorderPoint: parseInt(document.getElementById('reorderPoint').value)
    };
    
    sampleInventoryData.push(newItem);
    updateInventoryTable();
    updateInventoryStats();
    
    const modal = bootstrap.Modal.getInstance(document.getElementById('addInventoryModal'));
    modal.hide();
    form.reset();
  }
}

function updateInventoryStats() {
  const totalProducts = sampleInventoryData.length;
  const lowStock = sampleInventoryData.filter(item => item.quantity <= item.reorderPoint).length;
  const totalValue = sampleInventoryData.reduce((sum, item) => sum + (item.quantity * item.price), 0);
  const averageValue = totalValue / totalProducts;

  document.getElementById('totalProducts').textContent = totalProducts;
  document.getElementById('lowStockProducts').textContent = lowStock;
  document.getElementById('inventoryValue').textContent = totalValue.toFixed(2) + ' جنيه';
  document.getElementById('averageValue').textContent = averageValue.toFixed(2) + ' جنيه';
}

// Initialize inventory on page load
document.addEventListener('DOMContentLoaded', function() {
  initializeInventory();
  updateInventoryStats();
});

// Sample customer data
const sampleCustomers = [
  { 
    id: 1,
    name: 'شركة الأمل التجارية',
    phone: '0123456789',
    email: 'alamal@example.com',
    address: 'شارع التحرير، القاهرة',
    balance: 15000,
    lastTransaction: '2024-01-15'
  },
  {
    id: 2, 
    name: 'مؤسسة النور للتجارة',
    phone: '0198765432',
    email: 'alnoor@example.com',
    address: 'شارع الملك فهد، الرياض',
    balance: 25000,
    lastTransaction: '2024-01-14'
  }
];

function initializeCustomers() {
  displayCustomers();
  setupCustomerSearch();
  updateCustomerStats();
}

function displayCustomers() {
  const customersDiv = document.getElementById('customers');
  customersDiv.innerHTML = `
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2>إدارة العملاء</h2>
      <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addCustomerModal">
        <i class="fas fa-plus"></i> إضافة عميل جديد
      </button>
    </div>

    <!-- Customer Search & Filters -->
    <div class="card mb-4">
      <div class="card-body">
        <div class="row">
          <div class="col-md-8">
            <div class="input-group">
              <span class="input-group-text"><i class="fas fa-search"></i></span>
              <input type="text" class="form-control" id="customerSearch" placeholder="البحث عن عميل...">
            </div>
          </div>
          <div class="col-md-4">
            <select class="form-select" id="customerFilter">
              <option value="all">جميع العملاء</option>
              <option value="active">عملاء نشطون</option>
              <option value="inactive">عملاء غير نشطون</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <!-- Customer Statistics -->
    <div class="row mb-4">
      <div class="col-md-3">
        <div class="card bg-primary text-white">
          <div class="card-body">
            <h6 class="card-title">إجمالي العملاء</h6>
            <h3 id="totalCustomersCount">0</h3>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card bg-success text-white">
          <div class="card-body">
            <h6 class="card-title">إجمالي المبيعات</h6>
            <h3 id="totalCustomerSales">0</h3>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card bg-warning text-dark">
          <div class="card-body">
            <h6 class="card-title">متوسط المبيعات</h6>
            <h3 id="averageCustomerSales">0</h3>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card bg-info text-white">
          <div class="card-body">
            <h6 class="card-title">عملاء جدد</h6>
            <h3 id="newCustomersCount">0</h3>
          </div>
        </div>
      </div>
    </div>

    <!-- Customers Table -->
    <div class="card">
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-hover" id="customersTable">
            <thead>
              <tr>
                <th>الاسم</th>
                <th>رقم الهاتف</th>
                <th>البريد الإلكتروني</th>
                <th>العنوان</th>
                <th>الرصيد</th>
                <th>آخر معاملة</th>
                <th>إجراءات</th>
              </tr>
            </thead>
            <tbody>
              ${sampleCustomers.map(customer => `
                <tr>
                  <td>${customer.name}</td>
                  <td>${customer.phone}</td>
                  <td>${customer.email}</td>
                  <td>${customer.address}</td>
                  <td>${customer.balance} جنيه</td>
                  <td>${customer.lastTransaction}</td>
                  <td>
                    <button class="btn btn-sm btn-info me-1" onclick="viewCustomerDetails(${customer.id})">
                      <i class="fas fa-eye"></i>
                    </button>
                    <button class="btn btn-sm btn-primary me-1" onclick="editCustomer(${customer.id})">
                      <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-sm btn-danger" onclick="deleteCustomer(${customer.id})">
                      <i class="fas fa-trash"></i>
                    </button>
                  </td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  `;
}

function setupCustomerSearch() {
  const searchInput = document.getElementById('customerSearch');
  const filterSelect = document.getElementById('customerFilter');
  
  searchInput.addEventListener('input', filterCustomers);
  filterSelect.addEventListener('change', filterCustomers);
}

function filterCustomers() {
  const searchTerm = document.getElementById('customerSearch').value.toLowerCase();
  const filterValue = document.getElementById('customerFilter').value;
  
  const tbody = document.querySelector('#customersTable tbody');
  tbody.innerHTML = sampleCustomers
    .filter(customer => {
      const matchesSearch = 
        customer.name.toLowerCase().includes(searchTerm) ||
        customer.phone.includes(searchTerm) ||
        customer.email.toLowerCase().includes(searchTerm);
        
      if (filterValue === 'active') {
        return matchesSearch && customer.balance > 0;
      } else if (filterValue === 'inactive') {
        return matchesSearch && customer.balance === 0;
      }
      return matchesSearch;
    })
    .map(customer => `
      <tr>
        <td>${customer.name}</td>
        <td>${customer.phone}</td>
        <td>${customer.email}</td>
        <td>${customer.address}</td>
        <td>${customer.balance} جنيه</td>
        <td>${customer.lastTransaction}</td>
        <td>
          <button class="btn btn-sm btn-info me-1" onclick="viewCustomerDetails(${customer.id})">
            <i class="fas fa-eye"></i>
          </button>
          <button class="btn btn-sm btn-primary me-1" onclick="editCustomer(${customer.id})">
            <i class="fas fa-edit"></i>
          </button>
          <button class="btn btn-sm btn-danger" onclick="deleteCustomer(${customer.id})">
            <i class="fas fa-trash"></i>
          </button>
        </td>
      </tr>
    `).join('');
}

function updateCustomerStats() {
  document.getElementById('totalCustomersCount').textContent = sampleCustomers.length;
  document.getElementById('totalCustomerSales').textContent = sampleCustomers.reduce((sum, customer) => sum + customer.balance, 0) + ' جنيه';
  document.getElementById('averageCustomerSales').textContent = Math.round(sampleCustomers.reduce((sum, customer) => sum + customer.balance, 0) / sampleCustomers.length) + ' جنيه';
  document.getElementById('newCustomersCount').textContent = sampleCustomers.filter(customer => {
    const lastTransaction = new Date(customer.lastTransaction);
    const oneMonthAgo = new Date();
    oneMonthAgo.setMonth(oneMonthAgo.getMonth() - 1);
    return lastTransaction >= oneMonthAgo;
  }).length;
}

function viewCustomerDetails(id) {
  const customer = sampleCustomers.find(c => c.id === id);
  if (customer) {
    const modal = document.createElement('div');
    modal.className = 'modal fade';
    modal.innerHTML = `
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">تفاصيل العميل</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <strong>الاسم:</strong> ${customer.name}
            </div>
            <div class="mb-3">
              <strong>رقم الهاتف:</strong> ${customer.phone}
            </div>
            <div class="mb-3">
              <strong>البريد الإلكتروني:</strong> ${customer.email}
            </div>
            <div class="mb-3">
              <strong>العنوان:</strong> ${customer.address}
            </div>
            <div class="mb-3">
              <strong>الرصيد:</strong> ${customer.balance} جنيه
            </div>
            <div class="mb-3">
              <strong>آخر معاملة:</strong> ${customer.lastTransaction}
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إغلاق</button>
          </div>
        </div>
      </div>
    `;
    document.body.appendChild(modal);
    const modalInstance = new bootstrap.Modal(modal);
    modalInstance.show();
    modal.addEventListener('hidden.bs.modal', () => {
      document.body.removeChild(modal);
    });
  }
}

// Initialize customers section when the page loads
document.addEventListener('DOMContentLoaded', function() {
  const existingListeners = window.customEventsInitialized || [];
  if (!existingListeners.includes('customers')) {
    initializeCustomers();
    existingListeners.push('customers');
    window.customEventsInitialized = existingListeners;
  }
});

function editCustomer(id) {
  const customer = sampleCustomers.find(c => c.id === id);
  if (customer) {
    document.getElementById('customerName').value = customer.name;
    document.getElementById('customerPhone').value = customer.phone;
    document.getElementById('customerEmail').value = customer.email;
    document.getElementById('customerAddress').value = customer.address;
    
    const modal = new bootstrap.Modal(document.getElementById('addCustomerModal'));
    modal.show();
  }
}

function deleteCustomer(id) {
  if (confirm('هل أنت متأكد من حذف هذا العميل؟')) {
    const index = sampleCustomers.findIndex(c => c.id === id);
    if (index !== -1) {
      sampleCustomers.splice(index, 1);
      displayCustomers();
      updateCustomerStats();
    }
  }
}

function saveCustomer() {
  const form = document.getElementById('customerForm');
  if (form.checkValidity()) {
    const newCustomer = {
      id: sampleCustomers.length + 1,
      name: document.getElementById('customerName').value,
      phone: document.getElementById('customerPhone').value,
      email: document.getElementById('customerEmail').value,
      address: document.getElementById('customerAddress').value,
      balance: 0,
      lastTransaction: new Date().toISOString().split('T')[0]
    };
    
    sampleCustomers.push(newCustomer);
    displayCustomers();
    updateCustomerStats();
    
    const modal = bootstrap.Modal.getInstance(document.getElementById('addCustomerModal'));
    modal.hide();
    form.reset();
  }
}

// Initialize suppliers section
function initializeSuppliers() {
  displaySuppliers();
  setupSupplierSearch();
  updateSupplierStats();
}

function displaySuppliers() {
  const suppliersDiv = document.getElementById('suppliers');
  suppliersDiv.innerHTML = `
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2>إدارة الموردين</h2>
      <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addSupplierModal">
        <i class="fas fa-plus"></i> إضافة مورد جديد
      </button>
    </div>

    <!-- Supplier Search & Filters -->
    <div class="card mb-4">
      <div class="card-body">
        <div class="row">
          <div class="col-md-6">
            <div class="input-group">
              <span class="input-group-text"><i class="fas fa-search"></i></span>
              <input type="text" class="form-control" id="supplierSearch" placeholder="البحث عن مورد...">
            </div>
          </div>
          <div class="col-md-3">
            <select class="form-select" id="supplierCategoryFilter">
              <option value="">كل الفئات</option>
              <option value="إلكترونيات">إلكترونيات</option>
              <option value="أثاث">أثاث</option>
              <option value="مستلزمات مكتبية">مستلزمات مكتبية</option>
            </select>
          </div>
          <div class="col-md-3">
            <select class="form-select" id="supplierStatusFilter">
              <option value="">كل الحالات</option>
              <option value="active">نشط</option>
              <option value="inactive">غير نشط</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <!-- Supplier Statistics -->
    <div class="row mb-4">
      <div class="col-md-3">
        <div class="card bg-primary text-white">
          <div class="card-body">
            <h6 class="card-title">إجمالي الموردين</h6>
            <h3 id="totalSuppliersCount">0</h3>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card bg-success text-white">
          <div class="card-body">
            <h6 class="card-title">إجمالي المشتريات</h6>
            <h3 id="totalPurchases">0</h3>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card bg-warning text-dark">
          <div class="card-body">
            <h6 class="card-title">متوسط المشتريات</h6>
            <h3 id="averagePurchases">0</h3>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card bg-info text-white">
          <div class="card-body">
            <h6 class="card-title">موردين جدد</h6>
            <h3 id="newSuppliersCount">0</h3>
          </div>
        </div>
      </div>
    </div>

    <!-- Suppliers Table -->
    <div class="card">
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-hover" id="suppliersTable">
            <thead>
              <tr>
                <th>اسم المورد</th>
                <th>جهة الاتصال</th>
                <th>رقم الهاتف</th>
                <th>البريد الإلكتروني</th>
                <th>الفئة</th>
                <th>الرصيد</th>
                <th>آخر طلب</th>
                <th>إجراءات</th>
              </tr>
            </thead>
            <tbody>
              ${sampleSuppliers.map(supplier => `
                <tr>
                  <td>${supplier.name}</td>
                  <td>${supplier.contact}</td>
                  <td>${supplier.phone}</td>
                  <td>${supplier.email}</td>
                  <td>${supplier.category}</td>
                  <td>${supplier.balance} جنيه</td>
                  <td>${supplier.lastOrder}</td>
                  <td>
                    <button class="btn btn-sm btn-info me-1" onclick="viewSupplierDetails(${supplier.id})">
                      <i class="fas fa-eye"></i>
                    </button>
                    <button class="btn btn-sm btn-primary me-1" onclick="editSupplier(${supplier.id})">
                      <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-sm btn-danger" onclick="deleteSupplier(${supplier.id})">
                      <i class="fas fa-trash"></i>
                    </button>
                  </td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  `;
}

function setupSupplierSearch() {
  const searchInput = document.getElementById('supplierSearch');
  const categoryFilter = document.getElementById('supplierCategoryFilter');
  const statusFilter = document.getElementById('supplierStatusFilter');
  
  searchInput.addEventListener('input', filterSuppliers);
  categoryFilter.addEventListener('change', filterSuppliers);
  statusFilter.addEventListener('change', filterSuppliers);
}

function filterSuppliers() {
  const searchTerm = document.getElementById('supplierSearch').value.toLowerCase();
  const categoryFilter = document.getElementById('supplierCategoryFilter').value;
  const statusFilter = document.getElementById('supplierStatusFilter').value;
  
  const tbody = document.querySelector('#suppliersTable tbody');
  tbody.innerHTML = sampleSuppliers
    .filter(supplier => {
      const matchesSearch = 
        supplier.name.toLowerCase().includes(searchTerm) ||
        supplier.contact.toLowerCase().includes(searchTerm) ||
        supplier.phone.includes(searchTerm) ||
        supplier.email.toLowerCase().includes(searchTerm);
        
      const matchesCategory = !categoryFilter || supplier.category === categoryFilter;
      
      const isActive = new Date(supplier.lastOrder) >= new Date(Date.now() - 90 * 24 * 60 * 60 * 1000);
      const matchesStatus = !statusFilter || 
        (statusFilter === 'active' && isActive) ||
        (statusFilter === 'inactive' && !isActive);
        
      return matchesSearch && matchesCategory && matchesStatus;
    })
    .map(supplier => `
      <tr>
        <td>${supplier.name}</td>
        <td>${supplier.contact}</td>
        <td>${supplier.phone}</td>
        <td>${supplier.email}</td>
        <td>${supplier.category}</td>
        <td>${supplier.balance} جنيه</td>
        <td>${supplier.lastOrder}</td>
        <td>
          <button class="btn btn-sm btn-info me-1" onclick="viewSupplierDetails(${supplier.id})">
            <i class="fas fa-eye"></i>
          </button>
          <button class="btn btn-sm btn-primary me-1" onclick="editSupplier(${supplier.id})">
            <i class="fas fa-edit"></i>
          </button>
          <button class="btn btn-sm btn-danger" onclick="deleteSupplier(${supplier.id})">
            <i class="fas fa-trash"></i>
          </button>
        </td>
      </tr>
    `).join('');
}

function updateSupplierStats() {
  document.getElementById('totalSuppliersCount').textContent = sampleSuppliers.length;
  document.getElementById('totalPurchases').textContent = sampleSuppliers.reduce((sum, supplier) => sum + supplier.balance, 0) + ' جنيه';
  document.getElementById('averagePurchases').textContent = Math.round(sampleSuppliers.reduce((sum, supplier) => sum + supplier.balance, 0) / sampleSuppliers.length) + ' جنيه';
  document.getElementById('newSuppliersCount').textContent = sampleSuppliers.filter(supplier => {
    const lastOrder = new Date(supplier.lastOrder);
    const oneMonthAgo = new Date();
    oneMonthAgo.setMonth(oneMonthAgo.getMonth() - 1);
    return lastOrder >= oneMonthAgo;
  }).length;
}

function viewSupplierDetails(id) {
  const supplier = sampleSuppliers.find(s => s.id === id);
  if (supplier) {
    const modal = document.createElement('div');
    modal.className = 'modal fade';
    modal.innerHTML = `
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">تفاصيل المورد</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <strong>اسم المورد:</strong> ${supplier.name}
            </div>
            <div class="mb-3">
              <strong>جهة الاتصال:</strong> ${supplier.contact}
            </div>
            <div class="mb-3">
              <strong>رقم الهاتف:</strong> ${supplier.phone}
            </div>
            <div class="mb-3">
              <strong>البريد الإلكتروني:</strong> ${supplier.email}
            </div>
            <div class="mb-3">
              <strong>العنوان:</strong> ${supplier.address}
            </div>
            <div class="mb-3">
              <strong>الفئة:</strong> ${supplier.category}
            </div>
            <div class="mb-3">
              <strong>الرصيد:</strong> ${supplier.balance} جنيه
            </div>
            <div class="mb-3">
              <strong>آخر طلب:</strong> ${supplier.lastOrder}
            </div>
            <div class="mb-3">
              <strong>شروط الدفع:</strong> ${supplier.paymentTerms}
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إغلاق</button>
          </div>
        </div>
      </div>
    `;
    document.body.appendChild(modal);
    const modalInstance = new bootstrap.Modal(modal);
    modalInstance.show();
    modal.addEventListener('hidden.bs.modal', () => {
      document.body.removeChild(modal);
    });
  }
}

function editSupplier(id) {
  const supplier = sampleSuppliers.find(s => s.id === id);
  if (supplier) {
    document.getElementById('supplierName').value = supplier.name;
    document.getElementById('supplierContact').value = supplier.contact;
    document.getElementById('supplierPhone').value = supplier.phone;
    document.getElementById('supplierEmail').value = supplier.email;
    document.getElementById('supplierAddress').value = supplier.address;
    document.getElementById('supplierCategory').value = supplier.category;
    document.getElementById('paymentTerms').value = supplier.paymentTerms;
    
    const modal = new bootstrap.Modal(document.getElementById('addSupplierModal'));
    modal.show();
  }
}

function deleteSupplier(id) {
  if (confirm('هل أنت متأكد من حذف هذا المورد؟')) {
    const index = sampleSuppliers.findIndex(s => s.id === id);
    if (index !== -1) {
      sampleSuppliers.splice(index, 1);
      displaySuppliers();
      updateSupplierStats();
    }
  }
}

function saveSupplier() {
  const form = document.getElementById('supplierForm');
  if (form.checkValidity()) {
    const newSupplier = {
      id: sampleSuppliers.length + 1,
      name: document.getElementById('supplierName').value,
      contact: document.getElementById('supplierContact').value,
      phone: document.getElementById('supplierPhone').value,
      email: document.getElementById('supplierEmail').value,
      address: document.getElementById('supplierAddress').value,
      category: document.getElementById('supplierCategory').value,
      balance: 0,
      lastOrder: new Date().toISOString().split('T')[0],
      paymentTerms: document.getElementById('paymentTerms').value
    };
    
    sampleSuppliers.push(newSupplier);
    displaySuppliers();
    updateSupplierStats();
    
    const modal = bootstrap.Modal.getInstance(document.getElementById('addSupplierModal'));
    modal.hide();
    form.reset();
  }
}

// Initialize suppliers section when the page loads
document.addEventListener('DOMContentLoaded', function() {
  const existingListeners = window.customEventsInitialized || [];
  if (!existingListeners.includes('suppliers')) {
    initializeSuppliers();
    existingListeners.push('suppliers');
    window.customEventsInitialized = existingListeners;
  }
});

// Settings initialization added from plan
function initializeSettings() {
  const settingsDiv = document.getElementById('settings');
  settingsDiv.innerHTML = `
    <div class="row">
      <div class="col-md-6 mb-4">
        <div class="card">
          <div class="card-header bg-primary text-white">
            <h5 class="card-title mb-0">إعدادات الشركة</h5>
          </div>
          <div class="card-body">
            <form id="companySettingsForm">
              <div class="mb-3">
                <label class="form-label">اسم الشركة</label>
                <input type="text" class="form-control" id="companyName" placeholder="أدخل اسم الشركة">
              </div>
              <div class="mb-3">
                <label class="form-label">العنوان</label>
                <textarea class="form-control" id="companyAddress" rows="2" placeholder="أدخل عنوان الشركة"></textarea>
              </div>
              <div class="mb-3">
                <label class="form-label">رقم الهاتف</label>
                <input type="tel" class="form-control" id="companyPhone" placeholder="أدخل رقم الهاتف">
              </div>
              <div class="mb-3">
                <label class="form-label">البريد الإلكتروني</label>
                <input type="email" class="form-control" id="companyEmail" placeholder="أدخل البريد الإلكتروني">
              </div>
              <div class="mb-3">
                <label class="form-label">الرقم الضريبي</label>
                <input type="text" class="form-control" id="taxNumber" placeholder="أدخل الرقم الضريبي">
              </div>
              <button type="submit" class="btn btn-primary">حفظ إعدادات الشركة</button>
            </form>
          </div>
        </div>
      </div>

      <div class="col-md-6 mb-4">
        <div class="card">
          <div class="card-header bg-info text-white">
            <h5 class="card-title mb-0">إعدادات النظام</h5>
          </div>
          <div class="card-body">
            <form id="systemSettingsForm">
              <div class="mb-3">
                <label class="form-label">العملة الافتراضية</label>
                <select class="form-select" id="defaultCurrency">
                  <option value="EGP">جنيه مصري</option>
                  <option value="SAR">ريال سعودي</option>
                  <option value="USD">دولار أمريكي</option>
                </select>
              </div>
              <div class="mb-3">
                <label class="form-label">نسبة الضريبة الافتراضية</label>
                <div class="input-group">
                  <input type="number" class="form-control" id="defaultTaxRate" value="14">
                  <span class="input-group-text">%</span>
                </div>
              </div>
              <div class="mb-3">
                <label class="form-label">اللغة الافتراضية</label>
                <select class="form-select" id="defaultLanguage">
                  <option value="ar">العربية</option>
                  <option value="en">English</option>
                </select>
              </div>
              <div class="mb-3">
                <label class="form-label">عدد العناصر في الصفحة</label>
                <input type="number" class="form-control" id="itemsPerPage" value="10">
              </div>
              <div class="form-check mb-3">
                <input type="checkbox" class="form-check-input" id="enableNotifications">
                <label class="form-check-label">تفعيل الإشعارات</label>
              </div>
              <button type="submit" class="btn btn-info">حفظ إعدادات النظام</button>
            </form>
          </div>
        </div>
      </div>

      <div class="col-md-6 mb-4">
        <div class="card">
          <div class="card-header bg-success text-white">
            <h5 class="card-title mb-0">إعدادات الفواتير</h5>
          </div>
          <div class="card-body">
            <form id="invoiceSettingsForm">
              <div class="mb-3">
                <label class="form-label">بادئة رقم الفاتورة</label>
                <input type="text" class="form-control" id="invoicePrefix" placeholder="مثال: INV-">
              </div>
              <div class="mb-3">
                <label class="form-label">تذييل الفاتورة</label>
                <textarea class="form-control" id="invoiceFooter" rows="2" placeholder="نص تذييل الفاتورة"></textarea>
              </div>
              <div class="form-check mb-3">
                <input type="checkbox" class="form-check-input" id="showLogo">
                <label class="form-check-label">إظهار شعار الشركة</label>
              </div>
              <div class="form-check mb-3">
                <input type="checkbox" class="form-check-input" id="showQRCode">
                <label class="form-check-label">إظهار رمز QR</label>
              </div>
              <button type="submit" class="btn btn-success">حفظ إعدادات الفواتير</button>
            </form>
          </div>
        </div>
      </div>

      <div class="col-md-6 mb-4">
        <div class="card">
          <div class="card-header bg-warning text-dark">
            <h5 class="card-title mb-0">النسخ الاحتياطي</h5>
          </div>
          <div class="card-body">
            <div class="mb-4">
              <h6>آخر نسخة احتياطية</h6>
              <p id="lastBackupDate">لم يتم عمل نسخة احتياطية بعد</p>
            </div>
            <button type="button" class="btn btn-warning me-2" onclick="createBackup()">
              <i class="fas fa-download"></i> إنشاء نسخة احتياطية
            </button>
            <button type="button" class="btn btn-outline-warning" onclick="restoreBackup()">
              <i class="fas fa-upload"></i> استعادة نسخة احتياطية
            </button>
          </div>
        </div>
      </div>
    </div>
  `;

  // Initialize form handlers
  initializeSettingsForms();
}

function initializeSettingsForms() {
  // Company Settings Form
  document.getElementById('companySettingsForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const settings = {
      companyName: document.getElementById('companyName').value,
      address: document.getElementById('companyAddress').value,
      phone: document.getElementById('companyPhone').value,
      email: document.getElementById('companyEmail').value,
      taxNumber: document.getElementById('taxNumber').value
    };
    saveSettings('companySettings', settings);
    showAlert('success', 'تم حفظ إعدادات الشركة بنجاح');
  });

  // System Settings Form
  document.getElementById('systemSettingsForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const settings = {
      currency: document.getElementById('defaultCurrency').value,
      taxRate: document.getElementById('defaultTaxRate').value,
      language: document.getElementById('defaultLanguage').value,
      itemsPerPage: document.getElementById('itemsPerPage').value,
      notifications: document.getElementById('enableNotifications').checked
    };
    saveSettings('systemSettings', settings);
    showAlert('success', 'تم حفظ إعدادات النظام بنجاح');
  });

  // Invoice Settings Form
  document.getElementById('invoiceSettingsForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const settings = {
      prefix: document.getElementById('invoicePrefix').value,
      footer: document.getElementById('invoiceFooter').value,
      showLogo: document.getElementById('showLogo').checked,
      showQRCode: document.getElementById('showQRCode').checked
    };
    saveSettings('invoiceSettings', settings);
    showAlert('success', 'تم حفظ إعدادات الفواتير بنجاح');
  });

  // Load saved settings
  loadSavedSettings();
}

function saveSettings(key, settings) {
  localStorage.setItem(key, JSON.stringify(settings));
}

function loadSavedSettings() {
  // Load Company Settings
  const companySettings = JSON.parse(localStorage.getItem('companySettings'));
  if (companySettings) {
    document.getElementById('companyName').value = companySettings.companyName || '';
    document.getElementById('companyAddress').value = companySettings.address || '';
    document.getElementById('companyPhone').value = companySettings.phone || '';
    document.getElementById('companyEmail').value = companySettings.email || '';
    document.getElementById('taxNumber').value = companySettings.taxNumber || '';
  }

  // Load System Settings
  const systemSettings = JSON.parse(localStorage.getItem('systemSettings'));
  if (systemSettings) {
    document.getElementById('defaultCurrency').value = systemSettings.currency || 'EGP';
    document.getElementById('defaultTaxRate').value = systemSettings.taxRate || '14';
    document.getElementById('defaultLanguage').value = systemSettings.language || 'ar';
    document.getElementById('itemsPerPage').value = systemSettings.itemsPerPage || '10';
    document.getElementById('enableNotifications').checked = systemSettings.notifications || false;
  }

  // Load Invoice Settings
  const invoiceSettings = JSON.parse(localStorage.getItem('invoiceSettings'));
  if (invoiceSettings) {
    document.getElementById('invoicePrefix').value = invoiceSettings.prefix || '';
    document.getElementById('invoiceFooter').value = invoiceSettings.footer || '';
    document.getElementById('showLogo').checked = invoiceSettings.showLogo || false;
    document.getElementById('showQRCode').checked = invoiceSettings.showQRCode || false;
  }
}

function showAlert(type, message) {
  const alertDiv = document.createElement('div');
  alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
  alertDiv.innerHTML = `
    ${message}
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  `;
  document.querySelector('.main-content').insertBefore(alertDiv, document.querySelector('.main-content').firstChild);
  
  setTimeout(() => {
    alertDiv.remove();
  }, 3000);
}

function createBackup() {
  const backup = {
    companySettings: JSON.parse(localStorage.getItem('companySettings')),
    systemSettings: JSON.parse(localStorage.getItem('systemSettings')),
    invoiceSettings: JSON.parse(localStorage.getItem('invoiceSettings')),
    timestamp: new Date().toISOString()
  };

  const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(backup));
  const downloadAnchorNode = document.createElement('a');
  downloadAnchorNode.setAttribute("href", dataStr);
  downloadAnchorNode.setAttribute("download", "backup_" + new Date().toISOString() + ".json");
  document.body.appendChild(downloadAnchorNode);
  downloadAnchorNode.click();
  downloadAnchorNode.remove();
  
  document.getElementById('lastBackupDate').textContent = new Date().toLocaleString('ar-EG');
  showAlert('success', 'تم إنشاء نسخة احتياطية بنجاح');
}

function restoreBackup() {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = '.json';
  input.onchange = function(event) {
    const file = event.target.files[0];
    const reader = new FileReader();
    reader.onload = function(e) {
      try {
        const backup = JSON.parse(e.target.result);
        if (backup.companySettings) localStorage.setItem('companySettings', JSON.stringify(backup.companySettings));
        if (backup.systemSettings) localStorage.setItem('systemSettings', JSON.stringify(backup.systemSettings));
        if (backup.invoiceSettings) localStorage.setItem('invoiceSettings', JSON.stringify(backup.invoiceSettings));
        
        loadSavedSettings();
        showAlert('success', 'تم استعادة النسخة الاحتياطية بنجاح');
      } catch (error) {
        showAlert('danger', 'حدث خطأ أثناء استعادة النسخة الاحتياطية');
      }
    };
    reader.readAsText(file);
  };
  input.click();
}

// Initialize settings page when the page loads
document.addEventListener('DOMContentLoaded', function() {
  const existingListeners = window.customEventsInitialized || [];
  if (!existingListeners.includes('settings')) {
    initializeSettings();
    existingListeners.push('settings');
    window.customEventsInitialized = existingListeners;
  }
});

// Initialize reports page
function initializeReports() {
  const reportsDiv = document.getElementById('reports');
  reportsDiv.innerHTML = `
    <div class="row mb-4">
      <div class="col-12">
        <h2>التقارير</h2>
        <hr>
      </div>
    </div>

    <!-- Report Filters -->
    <div class="card mb-4">
      <div class="card-body">
        <div class="row">
          <div class="col-md-3">
            <label class="form-label">نوع التقرير</label>
            <select class="form-select" id="reportType">
              <option value="sales">تقرير المبيعات</option>
              <option value="purchases">تقرير المشتريات</option>
              <option value="inventory">تقرير المخزون</option>
              <option value="customers">تقرير العملاء</option>
              <option value="suppliers">تقرير الموردين</option>
              <option value="profit">تقرير الأرباح والخسائر</option>
            </select>
          </div>
          <div class="col-md-3">
            <label class="form-label">من تاريخ</label>
            <input type="date" class="form-control" id="startDate">
          </div>
          <div class="col-md-3">
            <label class="form-label">إلى تاريخ</label>
            <input type="date" class="form-control" id="endDate">
          </div>
          <div class="col-md-3">
            <label class="form-label">&nbsp;</label>
            <button class="btn btn-primary w-100" onclick="generateReport()">
              <i class="fas fa-sync"></i> توليد التقرير
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Report Summary Cards -->
    <div class="row mb-4">
      <div class="col-md-3">
        <div class="card bg-primary text-white">
          <div class="card-body">
            <h6 class="card-title">إجمالي المبيعات</h6>
            <h3 id="totalSalesReport">0 جنيه</h3>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card bg-success text-white">
          <div class="card-body">
            <h6 class="card-title">إجمالي المشتريات</h6>
            <h3 id="totalPurchasesReport">0 جنيه</h3>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card bg-info text-white">
          <div class="card-body">
            <h6 class="card-title">صافي الربح</h6>
            <h3 id="netProfitReport">0 جنيه</h3>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card bg-warning text-dark">
          <div class="card-body">
            <h6 class="card-title">عدد المعاملات</h6>
            <h3 id="transactionCountReport">0</h3>
          </div>
        </div>
      </div>
    </div>

    <!-- Report Charts -->
    <div class="row mb-4">
      <div class="col-md-6">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">تحليل المبيعات</h5>
            <div class="chart-container">
              <canvas id="salesAnalysisChart"></canvas>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">مقارنة الأداء</h5>
            <div class="chart-container">
              <canvas id="performanceComparisonChart"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Detailed Report Table -->
    <div class="card">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 class="card-title mb-0">تفاصيل التقرير</h5>
          <button class="btn btn-success" onclick="exportReport()">
            <i class="fas fa-file-excel"></i> تصدير إلى Excel
          </button>
        </div>
        <div class="table-responsive">
          <table class="table table-striped" id="reportTable">
            <thead>
              <tr>
                <th>التاريخ</th>
                <th>رقم المعاملة</th>
                <th>النوع</th>
                <th>العميل/المورد</th>
                <th>المبلغ</th>
                <th>الحالة</th>
              </tr>
            </thead>
            <tbody>
              <!-- Report data will be inserted here -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
  `;

  // Set default dates
  const today = new Date();
  const firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
  
  document.getElementById('startDate').value = firstDayOfMonth.toISOString().split('T')[0];
  document.getElementById('endDate').value = today.toISOString().split('T')[0];

  // Initialize charts
  initializeReportCharts();
  
  // Generate initial report
  generateReport();
}

function initializeReportCharts() {
  const salesCtx = document.getElementById('salesAnalysisChart').getContext('2d');
  const performanceCtx = document.getElementById('performanceComparisonChart').getContext('2d');

  // Sales Analysis Chart
  new Chart(salesCtx, {
    type: 'line',
    data: {
      labels: ['يناير', 'فبراير', 'مارس', 'ابريل', 'مايو', 'يونيو'],
      datasets: [{
        label: 'المبيعات',
        data: [65000, 72000, 68000, 85000, 78000, 90000],
        borderColor: '#3498db',
        fill: false
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false
    }
  });

  // Performance Comparison Chart
  new Chart(performanceCtx, {
    type: 'bar',
    data: {
      labels: ['المبيعات', 'المشتريات', 'المصروفات', 'الأرباح'],
      datasets: [{
        label: 'الشهر الحالي',
        data: [90000, 65000, 45000, 25000],
        backgroundColor: '#2ecc71'
      }, {
        label: 'الشهر السابق',
        data: [85000, 60000, 40000, 25000],
        backgroundColor: '#e74c3c'
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false
    }
  });
}

function generateReport() {
  const reportType = document.getElementById('reportType').value;
  const startDate = document.getElementById('startDate').value;
  const endDate = document.getElementById('endDate').value;

  // Sample data generation
  const sampleData = generateSampleReportData(startDate, endDate);
  
  // Update summary cards
  document.getElementById('totalSalesReport').textContent = sampleData.totalSales.toLocaleString() + ' جنيه';
  document.getElementById('totalPurchasesReport').textContent = sampleData.totalPurchases.toLocaleString() + ' جنيه';
  document.getElementById('netProfitReport').textContent = (sampleData.totalSales - sampleData.totalPurchases).toLocaleString() + ' جنيه';
  document.getElementById('transactionCountReport').textContent = sampleData.transactions.length;

  // Update table
  const tbody = document.querySelector('#reportTable tbody');
  tbody.innerHTML = sampleData.transactions.map(transaction => `
    <tr>
      <td>${transaction.date}</td>
      <td>${transaction.number}</td>
      <td>${transaction.type}</td>
      <td>${transaction.party}</td>
      <td>${transaction.amount.toLocaleString()} جنيه</td>
      <td>
        <span class="badge bg-${transaction.status === 'مكتمل' ? 'success' : 'warning'}">
          ${transaction.status}
        </span>
      </td>
    </tr>
  `).join('');
}

function generateSampleReportData(startDate, endDate) {
  // Generate sample transactions
  const transactions = [];
  const types = ['فاتورة مبيعات', 'فاتورة مشتريات', 'مصروفات'];
  const parties = ['شركة الأمل', 'مؤسسة النور', 'شركة التقدم', 'مؤسسة المستقبل'];
  const statuses = ['مكتمل', 'معلق'];
  
  let totalSales = 0;
  let totalPurchases = 0;

  for (let i = 0; i < 10; i++) {
    const amount = Math.floor(Math.random() * 50000) + 5000;
    const type = types[Math.floor(Math.random() * types.length)];
    
    if (type === 'فاتورة مبيعات') totalSales += amount;
    if (type === 'فاتورة مشتريات') totalPurchases += amount;

    transactions.push({
      date: new Date(startDate).toLocaleDateString('ar-EG'),
      number: 'TRX-' + (1000 + i),
      type: type,
      party: parties[Math.floor(Math.random() * parties.length)],
      amount: amount,
      status: statuses[Math.floor(Math.random() * statuses.length)]
    });
  }

  return {
    transactions,
    totalSales,
    totalPurchases
  };
}

function exportReport() {
  // Simulate Excel export
  alert('جاري تصدير التقرير...');
  setTimeout(() => {
    alert('تم تصدير التقرير بنجاح');
  }, 1000);
}

// Add to the existing DOMContentLoaded event listener
document.addEventListener('DOMContentLoaded', function() {
  const existingListeners = window.customEventsInitialized || [];
  if (!existingListeners.includes('reports')) {
    initializeReports();
    existingListeners.push('reports');
    window.customEventsInitialized = existingListeners;
  }
});
</script>
</body></html>